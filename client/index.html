<html>

<head>
	<title>otp.js Leaflet Client</title>

	<script src="../dist/otp.uncompressed.js"></script>
	<script src="../test/util.js"></script>

	<link rel="stylesheet" href="style.css" />
	<link rel="stylesheet" href="../src/narrative.css" />
	<link rel="stylesheet" href="../src/map.css" />

	<link rel="stylesheet" href="../node_modules/leaflet/dist/leaflet.css" />
</head>

<body>
	<div id="narrative"></div>
	<div id="map"></div>

<script type="text/javascript" language="javascript">
$(document).ready(function() {

	var map = L.map('map').setView([51.505, -0.09], 13);

	// add an OpenStreetMap tile layer
	L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
	    attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
	}).addTo(map);

	var api = "http://localhost:8080/opentripplanner-api-webapp/ws/plan"
    var requestModel = new OTP.models.OtpPlanRequest(helpers.testRequest, {urlRoot: api });

    var requestMapView = new OTP.views.OtpRequestMapView({
    	model: requestModel,
    	map: map
    });
    requestMapView.render();

    var narrativeView = new OTP.views.OtpPlanResponseNarrativeView({
        el: $('#narrative'),
        map: map,
    });

    requestModel.on('success', function(response) {
    	//narrativeView.model = response;
        //narrativeView.render();
        narrativeView.newResponse(response);
    });

    requestModel.request();
});
</script>

</body>

</html>