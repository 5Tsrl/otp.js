<!DOCTYPE html>


<html>

<head>
	<title>otp.js</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <script src="../dist/otp.uncompressed.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="selectize/selectize.js"></script>
    <script src="datetimepicker/bootstrap-datetimepicker.js"></script>

    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="datetimepicker/bootstrap-datetimepicker.css" />
	<link rel="stylesheet" href="selectize/selectize.bootstrap3.css" />

    <link rel="stylesheet" href="../node_modules/leaflet/dist/leaflet.css" />

    <!-- otp.js css include  -->

    <link rel="stylesheet" href="style.css" />    
	<link rel="stylesheet" href="../src/narrative.css" />
	<link rel="stylesheet" href="../src/map.css" />
    <link rel="stylesheet" href="../src/topo.css" />

	
    <link rel="stylesheet" href="leaflet.label.css" /> 

</head>

<body> 

    <div class="row">
        <div class="col-sm-4 col-md-3">
            <div class="row" id="request"></div>
            <div class="row" id="narrative"></div>
        </div>
        <div class="col-sm-8 col-md-9">
            <div id="map" style="height: 700px"></div>    
        </div>
    </div>
    

<script type="text/javascript" language="javascript">


$(document).ready(function() {

	var map = L.map('map').setView([44.9473,-123.0564], 13);
    map.attributionControl.setPrefix('');
    //var map = L.map('map').setView([45.52, -122.681944], 13);

	// add an OpenStreetMap tile layer
	var osmLayer = L.tileLayer('http://{s}.tiles.mapbox.com/v3/conveyal.map-jc4m5i21/{z}/{x}/{y}.png', {
        subdomains : ['a','b','c','d'],
	    attribution: 'Street Map: <a href="http://mapbox.com/about/maps">Terms & Feedback</a>'
	});
    
    var aerialLayer = L.tileLayer('http://{s}.tiles.mapbox.com/v3/conveyal.map-a3mk3jug/{z}/{x}/{y}.png', {
        subdomains : ['a','b','c','d'],
        attribution : 'Satellite Map: <a href="http://mapbox.com/about/maps">Terms & Feedback</a>'
    });

    var baseLayers = {
        "Street Map" : osmLayer,
        "Satellite Map" : aerialLayer
    };
    L.control.layers(baseLayers).addTo(map);
    osmLayer.addTo(map);

    var topoControl = new OTP.topo_views.LeafletTopoGraphControl();
    topoControl.addTo(map);
    
	var api = "http://10.0.1.67:8080/opentripplanner-api-webapp/ws/plan?"
    var requestModel = new OTP.models.OtpPlanRequest({}, {urlRoot: api }); 

    var requestView = new OTP.request_views.OtpRequestFormView({
        model: requestModel,
        el: $('#request')
    });

    requestView.render();

    var requestMapView = new OTP.map_views.OtpRequestMapView({
    	model: requestModel,
    	map: map
    });
    requestMapView.render();

    var responseView = new OTP.views.OtpPlanResponseView({
        narrative: $('#narrative'),
        map: map,
        topo: topoControl.getGraphElement()
    });

    requestModel.on('success', function(response) {
        responseView.newResponse(response);
    });

    requestModel.on('failure', function(response) {
        responseView.newResponse(response);
    });

    requestModel.request();

    $('#map').height($(window).height() - 30);
    map.invalidateSize();

    $(window).resize(function() { 
        $('#map').height($(window).height() - 30);
        map.invalidateSize();
    }); 

    // set up the stops request model and view
   /* var stopsApi = "http://10.1.10.75:8080/opentripplanner-api-webapp/ws/transit/stopsInRectangle?"
    var stopsRequestModel = new OTP.models.OtpStopsInRectangleRequest({}, {urlRoot: stopsApi });

    var stopsRequestMapView = new OTP.map_views.OtpStopsRequestMapView({
        model: stopsRequestModel,
        map: map
    });
    var stopsResponseMapView = new OTP.map_views.OtpStopsResponseMapView({
        map: map
    });
    stopsRequestModel.on('success', function(response) {
        stopsResponseMapView.newResponse(response);
    });*/

    
    
});


</script>

</body>

</html>